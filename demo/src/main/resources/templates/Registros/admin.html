

<!DOCTYPE html>
<html lang="es"
xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" th:href="@{/css/admin.css}">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script th:src="@{/js/scripts.js}"></script>

    <title>Admin Ventas - Dashboard</title>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1>SalesAdmin</h1>
                <p>Panel de Control</p>
            </div>
            
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a th:href="@{/admin/product/add}" class="nav-link">
                            <span class="nav-icon">üì¶</span>
                            Crear Productos
                        </a>
                    </li>
                    <li class="nav-item" id="crear_marca" style="display: none;">
                        <a th:href="@{/admin/marcas}" class="nav-link">
                            <span class="nav-icon">üìÉ</span>
                            Crear Marcas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a th:href="@{/admin/ventasproductos}" class="nav-link">
                            <span class="nav-icon">üîé</span>
                            Ventas de Productos
                        </a>
                    </li>
                     <li class="nav-item">
                        <a href="#" class="nav-link" onclick="openLogoutModal()">
                            <span class="nav-icon">üîå</span>
                            Cerrar Sesi√≥n
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

            <!-- Modal de advertencia de cerrar sesi√≥n -->
    <div id="logoutModal" class="modal confirm-modal">
        <div class="modal-content">
            <div class="confirm-icon">‚ö†Ô∏è</div>
            <h2 class="modal-title">¬øCerrar sesi√≥n?</h2>
            <p class="confirm-message">¬øEst√°s seguro de que deseas cerrar sesi√≥n?<br>Perder√°s el acceso a tu cuenta actual.</p>
            <div class="modal-buttons">
                <button type="button" class="btn-secondary" onclick="closeLogoutModal()">Cancelar</button>
                <button type="button" class="btn-danger" onclick="confirmLogout()">Cerrar sesi√≥n</button>
            </div>
        </div>
    </div>

    <script>
        // Funciones para el modal de cerrar sesi√≥n
        function openLogoutModal() {
            document.getElementById('logoutModal').style.display = 'block';
        }

        function closeLogoutModal() {
            document.getElementById('logoutModal').style.display = 'none';
        }

        function confirmLogout() {
            window.location.href = '/logout';
        }

        // Cerrar modal al hacer clic fuera de √©l
        window.onclick = function(event) {
            if (event.target == document.getElementById('logoutModal')) {
                closeLogoutModal();
            }
        }
    </script>

          <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div>
                <h1>¬°Buenas noches, Admin!</h1>
                <p>Aqu√≠ est√° el resumen de tu negocio hoy</p>
            </div>
            <div class="user-info">
                <div class="user-avatar">AD</div>
                <div class="user-details">
                    <h3>Admin</h3>
                    <span>Administrador</span>
                </div>
            </div>
        </div>

        <!-- Table Container -->
        <div class="table-container">
            <div class="table-header">
                <h2 class="table-title">Gesti√≥n de Productos</h2>
                <div class="header-actions">

                     <form class="search-form" method="get" action="/admin/admin">

                    <div class="category-filter">
                        <div class="select-wrapper">
                            <select class="custom-select" id="categoria" name="categoria" onchange="filterByCategory(this.value)">
                                <option value="1">Electr√≥nicos</option>
                                <option value="2">Computadoras</option>
                                <option value="3">Accesorios</option>
                                <option value="4">Perif√©ricos</option>
                            </select>
                            <span class="select-icon">‚ñº</span>
                        </div>
                    </div>

                   <!-- th:value="${nombre} ?: 'Valor por defecto'" -->

                        <input type="text" id="searchInput"  placeholder="Buscar producto..." class="search-input" name="nombre" >
                        <button type="submit" class="search-btn">üîç Buscar</button>
                    </form>
                    <button class="add-btn" onclick="openAddModal()">+ Agregar Producto</button>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Precio Venta</th>
                        <th>Precio Compra</th>
                        <th>Stock</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="productsTable">
                    <tr   th:each="item : ${productos}">
                        <td class="product-name" th:text="${item.nombre}"></td>
                        <td class="price" th:text="${item.precioVenta}"></td>
                        <td class="price" th:text="${item.precioCompra}"></td>
                        <td><span class="stock medium" th:text="${item.stock}"></span></td>
                        <td>
                            <div class="action-buttons">
                                <button type="button"  
                                    class="detail-btn btn btn-edit"
                                    th:data-nombre="${item.nombre}"
                                    th:data-precio-venta="${item.precioVenta}"
                                    th:data-precio-compra="${item.precioCompra}"
                                    th:data-stock="${item.stock}"
                                    th:data-imagen="${item.imagen}"
                                    th:data-imagen2="${item.imagenbase64}">
                                Detalles
                                </button>
                               <button class="edit-btn btn btn-edit"
                                    th:data-product="${item.id}"
                                    th:data-nombre="${item.nombre}"
                                    th:data-precio-venta="${item.precioVenta}"
                                    th:data-precio-compra="${item.precioCompra}"
                                    th:data-imagen2="${item.imagenbase64}"
                                    th:data-stock="${item.stock}"
                                    th:onclick="openEditModal(this)">
                                Editar
                            </button>
                                <button class="btn btn-delete" th:data-id="${item.id}"  th:onclick="openDeleteModal(this)">üóëÔ∏è Eliminar</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
            
 
      <!-- Pagination -->
<div class="pagination-container">
    <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center" >
            <li class="page-item" th:each="pageNumber : ${pageNumbers}">
                <a class="page-link" th:href="@{|/admin/admin?page=${pageNumber}|}" th:text="${pageNumber}"></a>
            </li>
            </ul>

    </nav>
</div>
             
            
        </div>
    </div>
    <style>.pagination {
    list-style: none;
    padding-left: 0;
    display: flex;
    justify-content: center;
    gap: 5px;
}

.pagination li {
    list-style: none;
}

.page-link {
    display: block;
    padding: 0.375rem 0.75rem;
    color: #0d6efd;
    text-decoration: none;
    background-color: #fff;
    border: 1px solid #dee2e6;
    border-radius: 0.25rem;
}

.page-link:hover {
    color: #0a58ca;
    background-color: #e9ecef;
    border-color: #dee2e6;
}</style>

        <!-- Detail Product Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Detalles del Producto</h2>
                <button class="close" onclick="closeDetailModal()">&times;</button>
            </div>

            <div class="form-group">
                <label>imagen:</label>

                <div id="detailImagen">
                    
                </div>
                
            </div>

            <div class="form-group">
                <label>Nombre:</label>
                <div id="detailName"></div>
            </div>
            <div class="form-group">
                <label>Precio de Venta:</label>
                <div id="detailSalePrice"></div>
            </div>
            <div class="form-group">
                <label>Precio de Compra:</label>
                <div id="detailPurchasePrice"></div>
            </div>
            <div class="form-group">
                <label>Stock:</label>
                <div id="detailStock"></div>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn-secondary" onclick="closeDetailModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Edit/Add Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">

            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Agregar Producto</h2>
                <button class="close" onclick="closeModal()">&times;</button>
            </div>
            <form id="productForm" method="post" th:object="${pojo}"th:action="@{/admin/product/update}" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="productImage">Imagen del Producto</label>
                    <div class="image-preview-container">
                        <div class="image-preview" id="imagePreview">
                            <p class="image-preview-text">Arrastra una imagen aqu√≠ o haz clic para seleccionar</p>
                        </div>
                        <input type="file" id="productImage" name="imagenFile" class="custom-file-input" accept="image/*">
                        <label for="productImage" class="custom-file-label">Seleccionar Imagen</label>
                    </div>

                </div>
                <input type="hidden" name="id"  th:field="*{id}" id="updateProductId" />

                <div class="form-group">
                    <label for="productName">Nombre del Producto</label>
                    <input type="text" name="nombre" th:field="*{nombre}" id="productName" requred/>
                </div>
                <div class="form-group">
                    <label for="salePrice">Precio de Compra</label>
                    <input type="number" name="precioCompra" th:field="*{precioCompra}" id="salePrice" step="0.01" required/>
                </div>
                <div class="form-group">
                    <label for="purchasePrice">Precio de Venta</label>
                    <input type="number" name="precioVenta"th:field="*{precioVenta}" id="purchasePrice" step="0.01" required/>
                </div>
                <div class="form-group">
                    <label for="stock">Stock</label>
                    <input type="number" name="stock" id="stock" th:field="*{stock}" required/>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar</button>
                </div>

            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal confirm-modal">
        <div class="modal-content">
            <form method="get" th:action="@{/admin/product/delete}">
            <div id="objetos">
                
                

            </div>
            <div class="confirm-icon">‚ö†Ô∏è</div>
            <h2 class="modal-title">Confirmar Eliminaci√≥n</h2>
            <p class="confirm-message">¬øEst√°s seguro de que quieres eliminar este producto?<br>Esta acci√≥n no se puede deshacer.</p>
            <div class="modal-buttons">
                <input id="imagen" type="hidden" name="id" value="2">
                <button type="button" class="btn-secondary" onclick="closeDeleteModal()">Cancelar</button>
                <button type="submit" class="btn-danger">Eliminar</button>
            </div>
            </form>

        </div>
    </div>
</div>

    <!-- Floating particles -->
    <div class="particle" style="width: 10px; height: 10px; top: 20%; left: 10%; animation-delay: 0s;"></div>
    <div class="particle" style="width: 6px; height: 6px; top: 60%; left: 80%; animation-delay: 2s;"></div>
    <div class="particle" style="width: 8px; height: 8px; top: 30%; left: 70%; animation-delay: 4s;"></div>
    <div class="particle" style="width: 4px; height: 4px; top: 80%; left: 20%; animation-delay: 1s;"></div>

    <script>
        // Manejo de la vista previa de imagen
        const imagePreview = document.getElementById('imagePreview');
        const productImage = document.getElementById('productImage');

        function obtenerCookie(nombre) {
  // A√±ade el signo de igual al nombre para buscarlo de forma exacta.
  const nombreConIgual = nombre + "="; 
  // Divide el string de cookies por el punto y coma.
  const cookiesDecodificadas = decodeURIComponent(document.cookie);
  const arrayCookies = cookiesDecodificadas.split(';');

  // Itera sobre el array para encontrar la cookie.
  for(let i = 0; i < arrayCookies.length; i++) {
    let cookie = arrayCookies[i];
    // Elimina los espacios en blanco al principio de cada cookie.
    while (cookie.charAt(0) === ' ') {
      cookie = cookie.substring(1);
    }
    // Si la cookie empieza con el nombre que buscamos, extrae el valor.
    if (cookie.indexOf(nombreConIgual) === 0) {
      return 1;
    }
  }
  return 0; // Devuelve un string vac√≠o si la cookie no se encuentra.
}

// Ejemplo de uso
let marca = obtenerCookie("marca");
console.log(marca); // Muestra "Juan" si la cookie "nombre" exist

 if (marca===0) {
    document.getElementById("crear_marca").style.display = "block";
 } else {
    
 }

        // Funci√≥n para mostrar la vista previa
        function showImagePreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.innerHTML = `<img src="${e.target.result}" alt="Vista previa">`;
            };
            reader.readAsDataURL(file);
        }

        // Manejo del input de archivo
        productImage.addEventListener('change', function(e) {
            const file = this.files[0];
            if (file && file.type.startsWith('image/')) {
                showImagePreview(file);
            }
        });

        // Manejo del arrastrar y soltar
        imagePreview.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });

        imagePreview.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });

        imagePreview.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                productImage.files = e.dataTransfer.files;
                showImagePreview(file);
            }
        });

        // Add smooth interactions solo para enlaces con href="#"
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                if (this.getAttribute('href') === '#') {
                    e.preventDefault();
                }
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });
        });


        // Dynamic greeting based on time
        const hour = new Date().getHours();
        // Cambia el saludo en el header principal
        const headerTitle = document.querySelector('.header h1');
        if (headerTitle) {
            if (hour < 12) {
                headerTitle.textContent = '¬°Buenos d√≠as, Admin!';
            } else if (hour < 18) {
                headerTitle.textContent = '¬°Buenas tardes, Admin!';
            } else {
                headerTitle.textContent = '¬°Buenas noches, Admin!';
            }
        }

        // Modal functions
        let products = [
            {
                name: "Laptop HP Pavilion",
                salePrice: 899.99,
                purchasePrice: 699.99,
                stock: 15
            },
            {
                name: "Mouse Logitech MX",
                salePrice: 89.99,
                purchasePrice: 65.99,
                stock: 45
            },
            {
                name: "Teclado Mec√°nico",
                salePrice: 129.99,
                purchasePrice: 89.99,
                stock: 3
            }
        ];

        let editIndex = -1;
        let deleteIndex = -1;

        function getStockClass(stock) {
            if (stock > 20) return 'high';
            if (stock > 10) return 'medium';
            return 'low';
        }

      

        // Modal de detalles
       document.addEventListener('click', function(e) {
        if (e.target.classList.contains('detail-btn')) {
            const btn = e.target;
            document.getElementById('detailName').textContent = btn.dataset.nombre;
            document.getElementById('detailSalePrice').textContent = '$' + btn.dataset.precioVenta;
            document.getElementById('detailPurchasePrice').textContent = '$' + btn.dataset.precioCompra;
            document.getElementById('detailStock').textContent = btn.dataset.stock;
            document.getElementById('detailModal').style.display = 'block';
     
            document.getElementById('detailImagen').innerHTML=`<img src='${btn.dataset.imagen2}'/>`;

        }
    });

        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Agregar Producto';
            document.getElementById('productForm').reset();
            editIndex = -1;
            document.getElementById('productModal').style.display = 'block';
        }

        function openEditModal(button) {
    // Obtener los datos del bot√≥n clickeado
            const nombre = button.dataset.nombre;
            const precioVenta = button.dataset.precioVenta;
            const precioCompra = button.dataset.precioCompra;
            const stock = button.dataset.stock;
            const imagen = button.dataset.imagen;

            
            
            // Establecer los valores en el modal
            document.getElementById('modalTitle').textContent = 'Editar Producto';
            document.getElementById('productName').value = nombre;
            document.getElementById('salePrice').value = precioVenta;
            document.getElementById('purchasePrice').value = precioCompra;
            document.getElementById('stock').value = stock;
            document.getElementById('updateProductId').value = button.dataset.product;
            document.getElementById('imagePreview').innerHTML=`<img src='${button.dataset.imagen2}'/>`;
            //imagePreview.innerHTML=`<img src='${btn.dataset.imagen2}'/>`;
            
            // Si tienes un campo de imagen, tambi√©n puedes manejarlo
            // document.getElementById('productImage').value = imagen;
            
            document.getElementById('productModal').style.display = 'block';
        }

        function openDeleteModal(button) {
           
            document.getElementById('deleteModal').style.display = 'block';
            document.getElementById('imagen').value=button.dataset.id
        }

        function closeModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            deleteIndex = -1;
        }

        function confirmDelete() {
            if (deleteIndex !== -1) {
                products.splice(deleteIndex, 1);
                renderTable();
            }
            closeDeleteModal();
        }

        

        // Close modal when clicking outside
        window.onclick = function(event) {
            const productModal = document.getElementById('productModal');
            const deleteModal = document.getElementById('deleteModal');
            if (event.target === productModal) {
                closeModal();
            }
            if (event.target === deleteModal) {
                closeDeleteModal();
            }
        }


            
        // Initial render
        renderTable();
    </script>
</body>
</html>