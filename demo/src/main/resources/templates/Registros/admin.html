

<!DOCTYPE html>
<html lang="es"
xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" th:href="@{/css/admin.css}">

    <title>Admin Ventas - Dashboard</title>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h1>SalesAdmin</h1>
                <p>Panel de Control</p>
            </div>
            
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a th:href="@{/admin/product/add}" class="nav-link">
                            <span class="nav-icon">üì¶</span>
                            Productos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a th:href="@{/admin/marcas}" class="nav-link">
                            <span class="nav-icon">üìÉ</span>
                            Gestion Marcas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="nav-icon">üë•</span>
                            Clientes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="nav-icon">üìà</span>
                            Reportes
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="nav-icon">üí∞</span>
                            Finanzas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            Configuraci√≥n
                        </a>
                    </li>
                     <li class="nav-item">
                        <a href="#" class="nav-link" onclick="openLogoutModal()">
                            <span class="nav-icon">üîå</span>
                            Cerrar Sesi√≥n
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

            <!-- Modal de advertencia de cerrar sesi√≥n -->
    <div id="logoutModal" class="modal confirm-modal">
        <div class="modal-content">
            <div class="confirm-icon">‚ö†Ô∏è</div>
            <h2 class="modal-title">¬øCerrar sesi√≥n?</h2>
            <p class="confirm-message">¬øEst√°s seguro de que deseas cerrar sesi√≥n?<br>Perder√°s el acceso a tu cuenta actual.</p>
            <div class="modal-buttons">
                <button type="button" class="btn-secondary" onclick="closeLogoutModal()">Cancelar</button>
                <button type="button" class="btn-danger" onclick="confirmLogout()">Cerrar sesi√≥n</button>
            </div>
        </div>
    </div>

    <script>
        // Funciones para el modal de cerrar sesi√≥n
        function openLogoutModal() {
            document.getElementById('logoutModal').style.display = 'block';
        }

        function closeLogoutModal() {
            document.getElementById('logoutModal').style.display = 'none';
        }

        function confirmLogout() {
            window.location.href = '/logout';
        }

        // Cerrar modal al hacer clic fuera de √©l
        window.onclick = function(event) {
            if (event.target == document.getElementById('logoutModal')) {
                closeLogoutModal();
            }
        }
    </script>

          <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div>
                <h1>¬°Buenas noches, Admin!</h1>
                <p>Aqu√≠ est√° el resumen de tu negocio hoy</p>
            </div>
            <div class="user-info">
                <div class="user-avatar">AD</div>
                <div class="user-details">
                    <h3>Admin</h3>
                    <span>Administrador</span>
                </div>
            </div>
        </div>

        <!-- Table Container -->
        <div class="table-container">
            <div class="table-header">
                <h2 class="table-title">Gesti√≥n de Productos</h2>
                <div class="header-actions">
                    <div class="category-filter">
                        <div class="select-wrapper">
                            <select class="custom-select" id="categoria" name="categoria" onchange="filterByCategory(this.value)">
                                <option value="">Todas las categor√≠as</option>
                                <option value="1">Electr√≥nicos</option>
                                <option value="2">Computadoras</option>
                                <option value="3">Accesorios</option>
                                <option value="4">Perif√©ricos</option>
                            </select>
                            <span class="select-icon">‚ñº</span>
                        </div>
                    </div>
                    <form class="search-form" onsubmit="searchProducts(event)">
                        <input type="text" id="searchInput" placeholder="Buscar producto..." class="search-input">
                        <button type="submit" class="search-btn">üîç Buscar</button>
                    </form>
                    <button class="add-btn" onclick="openAddModal()">+ Agregar Producto</button>
                </div>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Precio Venta</th>
                        <th>Precio Compra</th>
                        <th>Stock</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="productsTable">
                    <tr   th:each="item : ${productos}">
                        <td class="product-name" th:text="${item.nombre}"></td>
                        <td class="price" th:text="${item.precioVenta}"></td>
                        <td class="price" th:text="${item.precioCompra}"></td>
                        <td><span class="stock medium" th:text="${item.stock}"></span></td>
                        <td>
                            <div class="action-buttons">
                                 <button class="btn btn-edit" onclick="openDetailModal(${item})">üîç Detalles</button>
                                <button class="btn btn-edit" onclick="openEditModal(0)">‚úèÔ∏è Editar</button>
                                <button class="btn btn-delete" onclick="openDeleteModal(0)">üóëÔ∏è Eliminar</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Pagination -->
            <div class="pagination-container">
                <div class="pagination-info">
                    <span id="paginationInfo">Mostrando 1-5 de 15 productos</span>
                </div>
                <div class="pagination">
                    <div class="page-size-selector">
                        <label>Mostrar:</label>
                        <select id="pageSize" onchange="changePageSize()">
                            <option value="5" selected>5</option>
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                        <span>por p√°gina</span>
                    </div>
                    <button class="page-btn" id="prevBtn" onclick="prevPage()" disabled>
                        ‚óÄ Anterior
                    </button>
                    <div id="pageNumbers"></div>
                    <button class="page-btn" id="nextBtn" onclick="nextPage()">
                        Siguiente ‚ñ∂
                    </button>
                </div>
            </div>
        </div>
    </div>

        <!-- Detail Product Modal -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Detalles del Producto</h2>
                <button class="close" onclick="closeDetailModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>Nombre:</label>
                <div id="detailName"></div>
            </div>
            <div class="form-group">
                <label>Precio de Venta:</label>
                <div id="detailSalePrice"></div>
            </div>
            <div class="form-group">
                <label>Precio de Compra:</label>
                <div id="detailPurchasePrice"></div>
            </div>
            <div class="form-group">
                <label>Stock:</label>
                <div id="detailStock"></div>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn-secondary" onclick="closeDetailModal()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Edit/Add Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">


            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Agregar Producto</h2>
                <button class="close" onclick="closeModal()">&times;</button>
            </div>
            <form id="productForm">
                <div class="form-group">
                    <label for="productImage">Imagen del Producto</label>
                    <div class="image-preview-container">
                        <div class="image-preview" id="imagePreview">
                            <p class="image-preview-text">Arrastra una imagen aqu√≠ o haz clic para seleccionar</p>
                        </div>
                        <input type="file" id="productImage" class="custom-file-input" accept="image/*">
                        <label for="productImage" class="custom-file-label">Seleccionar Imagen</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="productName">Nombre del Producto</label>
                    <input type="text" id="productName" required>
                </div>
                <div class="form-group">
                    <label for="salePrice">Precio de Venta</label>
                    <input type="number" id="salePrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="purchasePrice">Precio de Compra</label>
                    <input type="number" id="purchasePrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="stock">Stock</label>
                    <input type="number" id="stock" required>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal confirm-modal">
        <div class="modal-content">
            <div class="confirm-icon">‚ö†Ô∏è</div>
            <h2 class="modal-title">Confirmar Eliminaci√≥n</h2>
            <p class="confirm-message">¬øEst√°s seguro de que quieres eliminar este producto?<br>Esta acci√≥n no se puede deshacer.</p>
            <div class="modal-buttons">
                <button type="button" class="btn-secondary" onclick="closeDeleteModal()">Cancelar</button>
                <button type="button" class="btn-danger" onclick="confirmDelete()">Eliminar</button>
            </div>
        </div>
    </div>
</div>

    <!-- Floating particles -->
    <div class="particle" style="width: 10px; height: 10px; top: 20%; left: 10%; animation-delay: 0s;"></div>
    <div class="particle" style="width: 6px; height: 6px; top: 60%; left: 80%; animation-delay: 2s;"></div>
    <div class="particle" style="width: 8px; height: 8px; top: 30%; left: 70%; animation-delay: 4s;"></div>
    <div class="particle" style="width: 4px; height: 4px; top: 80%; left: 20%; animation-delay: 1s;"></div>

    <script>
        // Manejo de la vista previa de imagen
        const imagePreview = document.getElementById('imagePreview');
        const productImage = document.getElementById('productImage');

        // Funci√≥n para mostrar la vista previa
        function showImagePreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                imagePreview.innerHTML = `<img src="${e.target.result}" alt="Vista previa">`;
            };
            reader.readAsDataURL(file);
        }

        // Manejo del input de archivo
        productImage.addEventListener('change', function(e) {
            const file = this.files[0];
            if (file && file.type.startsWith('image/')) {
                showImagePreview(file);
            }
        });

        // Manejo del arrastrar y soltar
        imagePreview.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });

        imagePreview.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });

        imagePreview.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                productImage.files = e.dataTransfer.files;
                showImagePreview(file);
            }
        });

        // Add smooth interactions solo para enlaces con href="#"
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                if (this.getAttribute('href') === '#') {
                    e.preventDefault();
                }
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });
        });


        // Dynamic greeting based on time
        const hour = new Date().getHours();
        // Cambia el saludo en el header principal
        const headerTitle = document.querySelector('.header h1');
        if (headerTitle) {
            if (hour < 12) {
                headerTitle.textContent = '¬°Buenos d√≠as, Admin!';
            } else if (hour < 18) {
                headerTitle.textContent = '¬°Buenas tardes, Admin!';
            } else {
                headerTitle.textContent = '¬°Buenas noches, Admin!';
            }
        }

        // Modal functions
        let products = [
            {
                name: "Laptop HP Pavilion",
                salePrice: 899.99,
                purchasePrice: 699.99,
                stock: 15
            },
            {
                name: "Mouse Logitech MX",
                salePrice: 89.99,
                purchasePrice: 65.99,
                stock: 45
            },
            {
                name: "Teclado Mec√°nico",
                salePrice: 129.99,
                purchasePrice: 89.99,
                stock: 3
            }
        ];

        let editIndex = -1;
        let deleteIndex = -1;

        function getStockClass(stock) {
            if (stock > 20) return 'high';
            if (stock > 10) return 'medium';
            return 'low';
        }

      

        // Modal de detalles
        function openDetailModal(index) {
            console.log(index);
            document.getElementById('detailName').textContent = product.name;
            document.getElementById('detailSalePrice').textContent = `$${product.salePrice.toFixed(2)}`;
            document.getElementById('detailPurchasePrice').textContent = `$${product.purchasePrice.toFixed(2)}`;
            document.getElementById('detailStock').textContent = product.stock;
            document.getElementById('detailModal').style.display = 'block';
        }

        function closeDetailModal() {
            document.getElementById('detailModal').style.display = 'none';
        }

        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Agregar Producto';
            document.getElementById('productForm').reset();
            editIndex = -1;
            document.getElementById('productModal').style.display = 'block';
        }

        function openEditModal(index) {
            const product = products[index];
            document.getElementById('modalTitle').textContent = 'Editar Producto';
            document.getElementById('productName').value = product.name;
            document.getElementById('salePrice').value = product.salePrice;
            document.getElementById('purchasePrice').value = product.purchasePrice;
            document.getElementById('stock').value = product.stock;
            editIndex = index;
            document.getElementById('productModal').style.display = 'block';
        }

        function openDeleteModal(index) {
            deleteIndex = index;
            document.getElementById('deleteModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            deleteIndex = -1;
        }

        function confirmDelete() {
            if (deleteIndex !== -1) {
                products.splice(deleteIndex, 1);
                renderTable();
            }
            closeDeleteModal();
        }

        document.getElementById('productForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const product = {
                name: document.getElementById('productName').value,
                salePrice: parseFloat(document.getElementById('salePrice').value),
                purchasePrice: parseFloat(document.getElementById('purchasePrice').value),
                stock: parseInt(document.getElementById('stock').value)
            };

            if (editIndex === -1) {
                products.push(product);
            } else {
                products[editIndex] = product;
            }

            renderTable();
            closeModal();
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const productModal = document.getElementById('productModal');
            const deleteModal = document.getElementById('deleteModal');
            if (event.target === productModal) {
                closeModal();
            }
            if (event.target === deleteModal) {
                closeDeleteModal();
            }
        }


            
        // Initial render
        renderTable();
    </script>
</body>
</html>